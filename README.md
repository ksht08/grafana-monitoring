# Система мониторинга тестового приложения

Данный репозиторий содержит конфигурацию для развертывания стенда мониторинга на базе Grafana, Prometheus и Loki. Проект предназначен для отслеживания технического состояния микросервисов и анализа бизнес-метрик.

## Адреса сервисов

После запуска проекта сервисы доступны по следующим адресам:

| Сервис | URL | Описание |
| :--- | :--- | :--- |
| **Grafana** | http://localhost:3000 | Визуализация данных и алертинг |
| **Test App** | http://localhost:5000 | Тестовое приложение (объект мониторинга) |
| **Test App Metrics** | http://localhost:5000/metrics | Метрики тестового приложения |
| **Prometheus** | http://localhost:9090 | Хранилище временных рядов (метрик) |
| **cAdvisor** | http://localhost:8080 | Источник метрик контейнеров |

## Структура Dashboards

Дашборд в Grafana разделен на четыре ключевых сегмента для комплексного анализа.

### 1. LOGS (LOKI INTEGRATION)
Визуализация текстовых данных из приложения. Позволяет быстро оценить стабильность системы по категориям:
* **INFO**: Информационные сообщения о штатной работе системы.
* **WARNING**: Предупреждения о потенциальных аномалиях.
* **ERROR**: Ошибки, требующие анализа и вмешательства.

### 2. HTTP STATUS CODES (PROMETHEUS)
Мониторинг сетевого взаимодействия на основе метрик `app_http_codes_total` и `app_http_codes_created`. Система отслеживает группы кодов:
* **1xx**: Протокольные сообщения (Informational)
* **2xx**: Успешные запросы (Success)
* **3xx**: Перенаправления (Redirection)
* **4xx**: Ошибки на стороне клиента (Client Error)
* **5xx**: Ошибки на стороне сервера (Server Error)

### 3. BUSINESS USER EVENTS
Специализированный раздел для отслеживания пользовательского опыта на основе метрик `business_user_actions_total` и `business_user_actions_created`:
* **User Register**: Регистрация нового пользователя `(action="register")`
* **User Login**: Авторизация в системе `(action="login")`
* **Reset Password**: Запросы на восстановление пароля `(action="reset_pass")`
* **Delete Account**: Удаление учетных записей `(action="delete_acc")`

### 4. LOAD SIMULATION (STRESS TEST)
Раздел для анализа поведения системы под нагрузкой. Позволяет увидеть корреляцию между ростом RPS и потреблением ресурсов (CPU/RAM).
Запрос для расчета текущего RPS:
```promql
sum(rate(app_http_codes_total[1m]))

## Примеры мониторинга контейнеров
Для контроля системных ресурсов используются метрики cAdvisor и встроенные метрики процесса.
Мониторинг оперативной памяти пользовательских приложений ()контейнеров:
```promql
container_memory_usage_bytes{name!="", name!~"cadvisor|prometheus|grafana|loki|promtail|.*exporter"}
```

Uptime приложения:
```promql
app_uptime_seconds
```

## Запуск проекта
Для развертывания стенда необходимо наличие Docker и Docker Compose. Все зависимости и связи между контейнерами преднастроены.
Для запуска выполнить:
```bash
docker-compose up -d
```